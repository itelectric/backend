name: ClickUp Integration
on:
  pull_request:
    branches:
      - develop
    types:
      - closed

jobs:
  update-clickup-task:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v2

      - name: Get task ID from branch name
        id: get_task_id
        run: |
          echo "TASK_ID=$(echo ${GITHUB_HEAD_REF} | sed -E 's/^[^-]+-([0-9]+).*$/\1/')"
          echo "TASK_ID=${TASK_ID}" >> $GITHUB_ENV

      - name: Update ClickUp task status to "RREADY TO DEVELOP"
        run: |
          curl -X PUT "https://api.clickup.com/api/v2/task/${{ env.TASK_ID }}" \
          -H "Authorization: ${{ secrets.CLICKUP_API_TOKEN }}" \
          -H "Content-Type: application/json" \
          -d '{
            "status": "READY TO DEVELOP"
          }'